(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9e8055a0"],{4088:function(e,t,r){},"9cb8":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container-box"},[r("el-form",{ref:"myform",staticClass:"my-form",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"活动标题",prop:"title"}},[r("el-input",{attrs:{placeholder:"请输入活动标题"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),r("el-form-item",{attrs:{label:"活动内容",prop:"content"}},[e.editflag?r("Tinymce",{ref:"editor",attrs:{height:300},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}}):e._e()],1),r("el-form-item",{attrs:{label:"发布单位"}},[r("el-input",{attrs:{placeholder:"请输入发布单位"},model:{value:e.ruleForm.author,callback:function(t){e.$set(e.ruleForm,"author",t)},expression:"ruleForm.author"}})],1),r("el-form-item",{attrs:{label:"活动地点",prop:"hdAddress"}},[r("el-input",{attrs:{placeholder:"请输入活动地点"},model:{value:e.ruleForm.hdAddress,callback:function(t){e.$set(e.ruleForm,"hdAddress",t)},expression:"ruleForm.hdAddress"}})],1),r("el-form-item",{attrs:{label:"活动人数"}},[r("el-input",{attrs:{placeholder:"默认为不限"},model:{value:e.ruleForm.limitusercount,callback:function(t){e.$set(e.ruleForm,"limitusercount",t)},expression:"ruleForm.limitusercount"}})],1),r("el-form-item",{attrs:{label:"置顶/热门"}},[r("div",{staticStyle:{"margin-left":"10px"}},[r("el-checkbox-group",{model:{value:e.ruleForm.hotstr,callback:function(t){e.$set(e.ruleForm,"hotstr",t)},expression:"ruleForm.hotstr"}},[r("el-checkbox",{attrs:{label:"置顶",value:1}}),r("el-checkbox",{attrs:{label:"热门",value:2}})],1)],1)]),r("el-form-item",{attrs:{label:"活动开始时间",prop:"begintime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{format:"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期"},model:{value:e.ruleForm.begintime,callback:function(t){e.$set(e.ruleForm,"begintime",t)},expression:"ruleForm.begintime"}})],1),r("el-form-item",{attrs:{label:"所属分类",prop:"categoryid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择分类"},model:{value:e.ruleForm.categoryid,callback:function(t){e.$set(e.ruleForm,"categoryid",t)},expression:"ruleForm.categoryid"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{label:e.Categorytitle,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"是否显示"}},[r("div",{staticStyle:{"margin-left":"10px"}},[r("el-switch",{attrs:{"active-text":"显示","inactive-text":"隐藏"},model:{value:e.ruleForm.isshow,callback:function(t){e.$set(e.ruleForm,"isshow",t)},expression:"ruleForm.isshow"}})],1)]),r("el-form-item",{attrs:{label:"排序ID"}},[r("el-input",{attrs:{placeholder:"ID越小越靠前"},model:{value:e.ruleForm.sortid,callback:function(t){e.$set(e.ruleForm,"sortid",t)},expression:"ruleForm.sortid"}})],1),r("el-form-item",{attrs:{label:"活动封面",prop:"imgurl"}},[r("el-upload",{attrs:{action:e.$store.state.user.beseFile,"list-type":"picture-card","on-success":e.handleSuccess,"on-error":e.handleError,"before-upload":e.beforeUpload,"on-remove":e.handleRemove,"file-list":e.fileList,limit:1}},[r("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"100%"},attrs:{slot:"trigger"},slot:"trigger"},[r("i",{staticClass:"el-icon-picture-outline",staticStyle:{"font-size":"80px"}}),r("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"14px","margin-top":"10px"}},[e._v("添加封面")])])])],1),r("el-form-item",[r("div",{staticClass:"but-b"},[r("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")]),r("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.btnloading,expression:"btnloading"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("myform")}}},[e._v("发布")])],1)])],1)],1)},l=[],i=r("5530"),a=r("c7eb"),s=r("1da1"),n=(r("a15b"),r("b8bc")),u=r("8256"),c=r("c24f"),m={components:{ImageUpload:n["a"],Tinymce:u["a"]},data:function(){var e=function(e,t,r){""===t||void 0===t?r(new Error("请上传封面")):r()};return{btnloading:!1,form:{},fileList:[],imgdialogVisible:!1,validateImg:e,dialogImageUrl:"",editflag:!1,containertext:"",ruleForm:{title:"",content:"",hdAddress:"",hotstr:[],limitusercount:"",categoryid:"",begintime:"",sortid:"",isshow:!0,author:"",imgurl:""},rules:{title:[{required:!0,message:"请输入活动标题",trigger:"blur"}],content:[{required:!0,message:"请填写活动内容",trigger:"change"}],categoryId:[{required:!0,message:"请选择所属类别",trigger:"change"}],imgurl:[{required:!0,trigger:"change",validator:e}]},options:[]}},created:function(){this.getselectlist()},mounted:function(){var e=this;Object(c["e"])({id:this.$route.query.id}).then((function(t){var r=t.datalist,o=r.Author,l=r.HdAddress,i=r.Limitusercount,a=r.Begintime,s=r.Title,n=r.Content,u=r.Hotstr,c=r.Categoryid,m=r.Sortid,d=r.Imgurl,g=r.Isshow;e.ruleForm.title=s,e.editflag=!0,e.ruleForm.author=o,e.ruleForm.limitusercount=i,e.ruleForm.begintime=a,e.ruleForm.hotstr=u.split(","),e.ruleForm.categoryid=c,e.ruleForm.sortid=m,e.ruleForm.hdAddress=l,e.ruleForm.isshow=!!g,e.ruleForm.imgurl=d,e.fileList=[{url:d}],e.$nextTick((function(){e.ruleForm.content=n,console.log(e.$refs.editor)}))}))},methods:{beforeUpload:function(e){var t="image/jpeg"===e.type,r="image/png"===e.type,o=e.size/1024/1024<10;return t||r||this.$message.error("上传图片只能是 JPG/PNG 格式!"),o||this.$message.error("上传图片大小不能超过 10MB!"),t||r&&o},handleSuccess:function(e){this.ruleForm.imgurl=e.filepath},handleError:function(e){this.$message.error(e.msg)},handleRemove:function(){this.ruleForm.imgurl="",this.fileList=[]},getselectlist:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){var r;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["j"])({channelname:e.$route.meta.channelname});case 2:r=t.sent,e.options=r.datalist;case 4:case"end":return t.stop()}}),t)})))()},getLatLng:function(){var e=this,t=new TMap.service.Geocoder({});t.getLocation({address:this.ruleForm.hdAddress}).then(function(){var t=Object(s["a"])(Object(a["a"])().mark((function t(r){var o,l,s,n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==r.status||"Success"!==r.message){t.next=12;break}return e.ruleForm.hdLat=r.result.location.lat,e.ruleForm.hdLng=r.result.location.lng,o=e.ruleForm,l=o.hotstr,s=o.isshow,e.ruleForm.hotstr=l.join(","),t.next=7,Object(c["n"])(Object(i["a"])(Object(i["a"])({},e.ruleForm),{},{id:e.$route.query.id,channelname:e.$route.meta.channelname,isshow:+s}));case 7:n=t.sent,200==n.status?(e.$message.success(n.msg),e.$router.go(-1)):e.$message.error(n.msg),e.btnloading=!1,t.next=14;break;case 12:e.btnloading=!1,e.$message.error("地址解析失败，请重新输入地址");case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.btnloading=!1,e.$message.error("地址解析错误，请检查后再试")}))},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(s["a"])(Object(a["a"])().mark((function e(r){return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r&&(t.btnloading=!0,t.getLatLng());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},d=m,g=(r("abe9"),r("2877")),h=Object(g["a"])(d,o,l,!1,null,"6389a226",null);t["default"]=h.exports},abe9:function(e,t,r){"use strict";r("4088")}}]);